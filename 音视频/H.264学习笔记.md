# H.264

## 概念
### YUV YCrCb
YUV来自于RGB模型，将亮度和色度分开。Y表示亮度，UV表示色差。  
YCrCb来自于YUV，应用于数字视频。Y表示亮度，Cb表示蓝色色度分量，Cr表示红色色度分量。  
每一种彩色空间都会产生一种亮度分量信号和两种色度分量信号  
YUV适用于PAC和SECAM彩色电视制式，YCrCb适用于显示器  
Y=0.299R+0587G+0.114B  
Cb=0564(B－Y)   
Cr=0.713(R－Y)  
R=Y+1.402Cr   
G=Y-0.344Cb-0.714Cr   
B=Y+1.772Cb   
#### 引入YUV的原因
人眼对Y更敏感，因此可以保证Y的情况下适当舍弃UV
#### 4:4:4 4:2:2 4:2:0 
1. 4:4:4，Y，Cb 和 Cr 具有同样的水平和垂直清晰度，在每一像素位置，都有 Y，Cb 和 Cr分量，即不论水平方向还是垂直方向，每 4 个亮度像素相应的有 4 个 Cb 和 4 个 Cr 色度像素。  
2. 4:2:2，这时彩色分量和亮度分量具有同样的垂直清晰度，但水平清晰度彩色分量是亮度分量的一半。水平方向上，每 4 个亮度像素具有 2 个 Cb 和 2 个 Cr。在 CCIR601 标准中，这是分量彩色电视的标准格式。  
3. 4:2:0，在水平和垂直清晰度方面，Cb 和 Cr 都是 Y 的一半。这个名词是历史上一直称呼的，似乎不合乎逻辑  


## 3 视频压缩编码的基本原理
### 3.1 预测编码
#### 3.1.1 基本概念
传递像素预测值与实际值之差的信号。因为大量统计表明，同一幅图像的邻近像素之间有着相关性，或者说这些像素值相似。对于接收端，差值q与预测值A相加得到原始值X。  
编码端：X－A=q  
解码端：q＋A=X
#### 3.1.2 帧内预测
原理，相邻的像素相关性越大，差值越小，因此可以进行压缩  
主要手段：
1. 一维最佳预测
2. 二维最佳预测
#### 3.1.3 帧间预测
单向预测，根据前面的参考帧得到当前帧  
双向预测，根据前后的参考帧得到当前帧  
H.264的参考帧可以达到5-15帧
#### 3.1.4 运动估计
在帧间预测编码中，由于活动图像邻近帧中的景物存在着一定的相关性。因此，可将活动图像
分成若干块或宏块，并设法搜索出每个块或宏块在邻近帧图像中的位置，并得出两者之间的空间位
置的相对偏移量，得到的相对偏移量就是通常所指的运动矢量，得到运动矢量的过程被称为运动估
计。
### 3.2 变换编码
#### 3.2.1 变换编码的基本概念
平坦区域和内容缓慢变化区域占据一幅图像的大部分，而细节区域和内容突变区域则占小部分。也可以说，图像中直流和低频区占大部分，高频区占小部分。这样，空间域的图像变换到频域或所谓的变换域，会产生相关性很小的一些变换系数，并可对其进行压缩编码，即所谓的变换编码。  
常用的变换手段有K-L变换和离散余弦变换DCT变换。  
最理想的变换操作应对整个图像进行，以便去除所有像素间的相关性。但这样的操作计算量太大。实际上，往往把图像分为若干块，以块为单位进行 DCT 变换。通常区 16×16或 8×8 组成小块。
#### 3.3.3 熵编码
经过K-L或者DCT后，低频部分会有较大的值，而高频部分会有较小的值。因此，可以对高频部分进行熵编码，从而减少编码后的空间。  
常用哈夫曼或者游程编码
游程编码：将变换后的系数进行锯齿形扫描会得到一个序列  
例如：15，0，0，-3，4，5，0，0，0，0，-7，0，0，0.......
（0的个数（游程），系数值，其后是否全为0）  
编码后的值：  
（0，15，0），（2，-3，0），（0，4，0），（0，5，0），（4，-7，1）  
现常用的遍满框架为对图像先进行带有运动补偿的帧间预测编码，再对预测后残差信号进行 DCT变换  

## H.264
### H.264 编码器
编码器采用的仍是变换和预测的混合编码法。
输入的帧Fn以宏块为单位（16x16）
## 6.3 H.264 结构
### 名词解释
1. 场和帧  
   一帧分为隔行的场
2. 宏块  
   一个图像分为若干宏块，每个宏块的大小为16x16像素和附加一个个 8×8 Cb和一个 8×8 Cr 彩色像素块组成。